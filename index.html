<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Seismo-Wake ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050608;
      --bg-elevated: #111319;
      --bg-soft: #181b23;
      --accent: #ffd447;
      --accent-soft: rgba(255, 212, 71, 0.1);
      --text: #f7f7f7;
      --text-muted: #a5a9b8;
      --danger-high: #ff4b4b;
      --danger-med: #ffb347;
      --danger-low: #36d399;
      --border-soft: #262938;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 14px 35px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #151827 0, #050608 55%);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 960px;
      padding: 14px 12px 24px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 14px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .app-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 11px;
      font-weight: 600;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: rgba(3, 8, 23, 0.9);
      color: var(--accent);
      text-transform: uppercase;
    }

    .updated-time {
      font-size: 13px;
      color: var(--text-muted);
    }

    .status-card {
      background: linear-gradient(135deg, rgba(15,18,28,0.96), rgba(7,9,16,0.98));
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .status-main-text {
      font-size: 16px;
      font-weight: 600;
    }

    .status-pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--danger-low);
    }

    .status-pill.low {
      background: rgba(54, 211, 153, 0.14);
      color: var(--danger-low);
    }
    .status-pill.medium {
      background: rgba(255, 179, 71, 0.14);
      color: var(--danger-med);
    }
    .status-pill.high {
      background: rgba(255, 75, 75, 0.16);
      color: var(--danger-high);
    }
    .status-pill.medium .status-dot {
      background: var(--danger-med);
    }
    .status-pill.high .status-dot {
      background: var(--danger-high);
    }

    .status-subtext {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .location-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .location-info {
      font-size: 13px;
      color: var(--text-muted);
    }

    .chip-btn {
      font-size: 13px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(12,16,26,0.95);
      color: var(--text);
      cursor: pointer;
    }

    .chip-btn:hover {
      border-color: var(--accent);
    }

    .donate-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
      border-top: 1px dashed rgba(255,255,255,0.07);
      padding-top: 8px;
    }

    .donate-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .donate-btn {
      flex: 1 1 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: var(--bg-soft);
      color: var(--text);
      font-size: 13px;
      padding: 7px 10px;
      cursor: pointer;
      text-decoration: none;
    }

    .donate-btn span.emoji {
      font-size: 15px;
    }

    .donate-btn.boosty {
      border-color: rgba(255, 212, 71, 0.7);
    }

    .donate-hint {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .donate-hint strong {
      color: var(--accent);
      font-weight: 600;
    }

    .donate-caption {
      font-size: 12px;
      color: var(--text-muted);
    }

    main {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
    }

    .tools-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tool-btn {
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: var(--bg-soft);
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .tool-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .events-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .event-card {
      position: relative;
      border-radius: var(--radius-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-soft);
      padding: 9px 10px 8px 12px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .event-danger-bar {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      border-radius: var(--radius-md) 0 0 var(--radius-md);
      background: var(--danger-low);
    }

    .event-card.medium .event-danger-bar {
      background: var(--danger-med);
    }

    .event-card.high .event-danger-bar {
      background: var(--danger-high);
    }

    .event-main-line {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .event-mag {
      font-weight: 700;
    }

    .event-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    .event-second-line,
    .event-third-line {
      font-size: 13px;
      color: var(--text-muted);
    }

    .event-links {
      margin-top: 3px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .event-source {
      font-size: 11px;
      color: var(--text-muted);
    }

    .event-link {
      font-size: 12px;
      color: var(--accent);
      text-decoration: none;
    }

    .event-link:hover {
      text-decoration: underline;
    }

    .empty-state,
    .error-state {
      font-size: 13px;
      color: var(--text-muted);
      padding: 10px;
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-soft);
      background: rgba(9, 12, 21, 0.9);
    }

    footer {
      margin-top: 18px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Modal */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.visible {
      display: flex;
    }

    @media (min-width: 640px) {
      .modal-backdrop {
        align-items: center;
      }
    }

    .modal {
      width: 100%;
      max-width: 720px;
      max-height: 90vh;
      background: #0b0d15;
      border-radius: 18px 18px 0 0;
      border: 1px solid var(--border-soft);
      box-shadow: 0 18px 45px rgba(0,0,0,0.75);
      padding: 12px 14px 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: translateY(8px);
    }

    @media (min-width: 640px) {
      .modal {
        border-radius: 18px;
        padding: 16px 18px 18px;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .modal-title {
      font-size: 17px;
      font-weight: 600;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 3px 4px;
    }

    .modal-body {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.45;
      overflow-y: auto;
      padding-right: 4px;
    }

    .modal-body p {
      margin: 4px 0 6px;
    }

    .modal-body h4 {
      margin: 10px 0 4px;
      font-size: 14px;
      color: var(--text);
    }

    .modal-body ul {
      padding-left: 18px;
      margin: 4px 0 8px;
    }

    .modal-body li {
      margin-bottom: 4px;
    }

    .modal-body small {
      font-size: 11px;
      color: var(--text-muted);
    }

    .modal-body a {
      color: var(--accent);
      text-decoration: none;
    }

    .modal-body a:hover {
      text-decoration: underline;
    }

    /* Location modal */

    .location-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 2px;
    }

    .location-form-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .field {
      flex: 1 1 120px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .field label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .field input {
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #050710;
      color: var(--text);
      font-size: 13px;
    }

    .field input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .quick-cities {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .quick-city-btn {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #060814;
      color: var(--text-muted);
      cursor: pointer;
    }

    .quick-city-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .location-actions {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn-primary {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: var(--accent);
      color: #131313;
    }

    .btn-secondary {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #050710;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 13px;
    }

    @media (max-width: 520px) {
      .app-title {
        font-size: 20px;
      }
      .status-main-text {
        font-size: 15px;
      }
      .status-subtext {
        font-size: 12px;
      }
      .location-info {
        font-size: 12px;
      }
      .event-main-line {
        font-size: 13px;
      }
      .event-second-line,
      .event-third-line {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="app-title-row">
      <div class="app-title">
        Seismo-Wake
        <span class="badge">beta</span>
      </div>
      <div class="updated-time" id="updatedTime">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ‚Ä¶</div>
    </div>

    <div class="status-card" id="statusCard">
      <div class="status-row">
        <div class="status-main-text" id="statusMain">–ê–Ω–∞–ª–∏–∑ –±–ª–∏–∂–∞–π—à–∏—Ö –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π‚Ä¶</div>
        <div class="status-pill low" id="statusPill">
          <span class="status-dot"></span>
          <span id="statusPillText">–°–ø–æ–∫–æ–π–Ω–æ</span>
        </div>
      </div>
      <div class="status-subtext" id="statusSub">
        –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å–µ–π—Å–º–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.
      </div>
      <div class="location-row">
        <div class="location-info" id="locationInfo">
          –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è‚Ä¶
        </div>
        <button class="chip-btn" data-open-modal="locationModal">–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
      </div>
      <div class="donate-row">
        <div class="donate-buttons">
          <a class="donate-btn boosty" href="https://boosty.to/zhanat-arch" target="_blank" rel="noopener noreferrer">
            <span class="emoji">üí≥</span>
            <span>Boosty ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –ª—é–±–∞—è –∫–∞—Ä—Ç–∞</span>
          </a>
          <a class="donate-btn" href="https://ko-fi.com/zhanat_arch" target="_blank" rel="noopener noreferrer">
            <span class="emoji">‚òï</span>
            <span>Ko-fi ‚Äî PayPal / –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ</span>
          </a>
        </div>
        <div class="donate-hint">
          <strong>–í–∞—à –¥–æ–Ω–∞—Ç –º–æ–∂–µ—Ç –æ–¥–Ω–∞–∂–¥—ã —Å–ø–∞—Å—Ç–∏ –∂–∏–∑–Ω—å.</strong><br>
          –í—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞–Ω–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö –∏ –ø–æ–º–æ–≥–∞–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –≤—Å–µ—Ö.
        </div>
        <div class="donate-caption">
          –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –∏ GitHub-–ø—Ä–æ—Ñ–∏–ª–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –µ—Å–ª–∏ –≤–∞–º –≤–∞–∂–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="section-header">
      <div class="section-title">–ù–µ–¥–∞–≤–Ω–∏–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏</div>
      <div class="tools-row">
        <button class="tool-btn" data-open-modal="howModal">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</button>
        <button class="tool-btn" data-open-modal="safetyModal">–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–∏</button>
      </div>
    </div>

    <div id="eventsContainer">
      <div class="empty-state">
        –ü–æ–¥–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è‚Ä¶ –ï—Å–ª–∏ —Ä—è–¥–æ–º –±—ã–ª–∏ –æ—â—É—Ç–∏–º—ã–µ —Ç–æ–ª—á–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å, –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.
      </div>
    </div>
  </main>

  <footer>
    <div>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: USGS (–æ—Å–Ω–æ–≤–Ω–æ–π) ‚Üí EMSC (—Ä–µ–∑–µ—Ä–≤) ‚Üí –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞.</div>
    <div>–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: <a href="https://github.com/zhanat-arch" target="_blank" rel="noopener noreferrer">github.com/zhanat-arch</a></div>
    <div>‚ö†Ô∏è –§–æ–Ω–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–µ.</div>
  </footer>
</div>

<!-- Modal backdrop -->
<div class="modal-backdrop" id="modalBackdrop" data-active-modal="">
  <!-- How it works -->
  <div class="modal" id="howModal">
    <div class="modal-header">
      <div class="modal-title">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
      <button class="modal-close" data-close-modal>&times;</button>
    </div>
    <div class="modal-body">
      <p><strong>Seismo-Wake ‚Äî —ç—Ç–æ –ª—ë–≥–∫–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</strong> –û–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å–µ–π—Å–º–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Å–æ–±—ã—Ç–∏–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.</p>

      <h4>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h4>
      <ul>
        <li>–û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî USGS (–°–®–ê, –º–∏—Ä–æ–≤–æ–π –æ—Ö–≤–∞—Ç).</li>
        <li>–†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî EMSC (–ï–≤—Ä–æ–ø–∞ –∏ –º–∏—Ä).</li>
        <li>–ï—Å–ª–∏ –æ–±–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞.</li>
      </ul>

      <h4>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏</h4>
      <p>
        –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <strong>–Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</strong>, –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞, —Å–≤—ë—Ä–Ω—É—Ç–∞ –∏–ª–∏ –≤—ã–≥—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–æ–π.
        Seismo-Wake —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –Ω–µ ¬´–±—É–¥–∏—Ç¬ª —Ç–µ–ª–µ—Ñ–æ–Ω –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.
      </p>
      <p>
        <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, Web Push –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–≤–æ–≥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</strong>
      </p>

      <h4>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å</h4>
      <ul>
        <li>–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ Seismo-Wake –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–æ–ª—á–∫–∞—Ö –∏–ª–∏ –≤ –ø–µ—Ä–∏–æ–¥ –∞—Ñ—Ç–µ—Ä—à–æ–∫–æ–≤.</li>
        <li>–î–µ—Ä–∂–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É –æ—Ç–∫—Ä—ã—Ç–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.</li>
        <li>–û—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Ü–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
          <br>–∑–µ–ª—ë–Ω—ã–π ‚Äî —Å–ø–æ–∫–æ–π–Ω–æ, –∂—ë–ª—Ç—ã–π ‚Äî –µ—Å—Ç—å –æ—â—É—Ç–∏–º—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–≥–∏–æ–Ω–µ, –∫—Ä–∞—Å–Ω—ã–π ‚Äî –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –±–ª–∏–∑–∫–æ.
        </li>
        <li>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
          <br><strong>–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥</strong> –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ,
          <br><strong>–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥</strong> ‚Äî –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (–ø–æ–∫–∞ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –≤—ã–≥—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–æ–π).</li>
      </ul>

      <h4>–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h4>
      <p>
        –ù–æ–≤–æ—Å—Ç–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∑–¥–µ—Å—å:
        <br>
        üëâ <a href="https://github.com/zhanat-arch" target="_blank" rel="noopener noreferrer">https://github.com/zhanat-arch</a>
      </p>

      <h4>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</h4>
      <p>
        –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–æ–Ω–∞—Ç–æ–º ‚Äî –ª—é–±–æ–π –≤–∫–ª–∞–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç.
      </p>
    </div>
  </div>

  <!-- Safety instructions -->
  <div class="modal" id="safetyModal">
    <div class="modal-header">
      <div class="modal-title">–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–∏</div>
      <button class="modal-close" data-close-modal>&times;</button>
    </div>
    <div class="modal-body">
      <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–æ—Å–∏—Ç –æ–±—â–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ú–ß–° –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.</strong></p>

      <h4>1. –î–æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è</h4>
      <ul>
        <li>–ü—Ä–æ–¥—É–º–∞–π—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ, –≥–¥–µ –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è <strong>–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Å—Ç–∞</strong>: —É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç–µ–Ω, –ø–æ–¥ –ø—Ä–æ—á–Ω—ã–º —Å—Ç–æ–ª–æ–º, –≤–¥–∞–ª–∏ –æ—Ç –æ–∫–æ–Ω.</li>
        <li>–ù–µ –∑–∞—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ—Ö–æ–¥—ã —Ç—è–∂—ë–ª—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ ‚Äî –ø—É—Ç–∏ –≤—ã—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã.</li>
        <li>–ó–∞–∫—Ä–µ–ø–∏—Ç–µ –≤—ã—Å–æ–∫—É—é –º–µ–±–µ–ª—å, –∑–µ—Ä–∫–∞–ª–∞ –∏ –ø–æ–ª–∫–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ —É–ø–∞–ª–∏ –ø—Ä–∏ —Ç–æ–ª—á–∫–∞—Ö.</li>
        <li>–î–µ—Ä–∂–∏—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π —Ñ–æ–Ω–∞—Ä–∏–∫, –≤–æ–¥—É, –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∞–ø—Ç–µ—á–∫—É, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∑–∞—Ä—è–¥–∫—É –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É.</li>
      </ul>

      <h4>2. –í–æ –≤—Ä–µ–º—è –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è ‚Äî –≤–Ω—É—Ç—Ä–∏ –∑–¥–∞–Ω–∏—è</h4>
      <ul>
        <li><strong>–ù–µ –±–µ–≥–∏—Ç–µ –∫ –≤—ã—Ö–æ–¥—É –∏ –Ω–µ –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª–∏—Ñ—Ç–æ–º.</strong> –õ–µ—Å—Ç–Ω–∏—Ü—ã, –ª–∏—Ñ—Ç–æ–≤—ã–µ —à–∞—Ö—Ç—ã –∏ –≤—ã—Ö–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω—ã –∏–∑-–∑–∞ –æ–±—Ä—É—à–µ–Ω–∏–π –∏ –ø–∞–Ω–∏–∫–∏.</li>
        <li>–ë—ã—Å—Ç—Ä–æ –ø—Ä–∏—Å—è–¥—å—Ç–µ –∏–ª–∏ –ª—è–≥—Ç–µ –Ω–∞ –ø–æ–ª, <strong>–ø—Ä–∏–∫—Ä–æ–π—Ç–µ –≥–æ–ª–æ–≤—É –∏ —à–µ—é</strong> —Ä—É–∫–∞–º–∏, –ø–æ–¥—É—à–∫–æ–π –∏–ª–∏ —Å–≤–µ—Ä–Ω—É—Ç–æ–π –æ–¥–µ–∂–¥–æ–π.</li>
        <li>–ï—Å–ª–∏ —Ä—è–¥–æ–º –µ—Å—Ç—å –ø—Ä–æ—á–Ω—ã–π —Å—Ç–æ–ª ‚Äî <strong>—É–∫—Ä–æ–π—Ç–µ—Å—å –ø–æ–¥ –Ω–∏–º</strong> –∏ –¥–µ—Ä–∂–∏—Ç–µ—Å—å –∑–∞ –Ω–æ–∂–∫—É.</li>
        <li><strong>–ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ä–∏–≥–µ–ª–∏ –∏–ª–∏ –Ω–µ—Å—É—â–∏–µ –±–∞–ª–∫–∏ ‚Äî –≤—Å—Ç–∞–Ω—å—Ç–µ –ø–æ–¥ –Ω–∏–º–∏.</strong> –û–Ω–∏ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –ª—É—á—à–µ –∏ –º–æ–≥—É—Ç —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ç –ø–∞–¥–∞—é—â–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤.</li>
        <li>–î–µ—Ä–∂–∏—Ç–µ—Å—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç —Å—Ç–µ–∫–æ–ª, –∑–µ—Ä–∫–∞–ª, —à–∫–∞—Ñ–æ–≤, —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–æ–≤ –∏ –≤—Å–µ–≥–æ, —á—Ç–æ –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å.</li>
      </ul>

      <h4>3. –í–æ –≤—Ä–µ–º—è –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è ‚Äî –Ω–∞ —É–ª–∏—Ü–µ</h4>
      <ul>
        <li>–û—Ç–æ–π–¥–∏—Ç–µ –æ—Ç –∑–¥–∞–Ω–∏–π, –±–∞–ª–∫–æ–Ω–æ–≤, –≤–∏—Ç—Ä–∏–Ω, –æ–∫–æ–Ω, —Å—Ç–æ–ª–±–æ–≤, –¥–µ—Ä–µ–≤—å–µ–≤ –∏ –ø—Ä–æ–≤–æ–¥–æ–≤.</li>
        <li>–ù–∞–π–¥–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –ø—Ä–∏—Å—è–¥—å—Ç–µ –∏ –ø—Ä–∏–∫—Ä–æ–π—Ç–µ –≥–æ–ª–æ–≤—É.</li>
        <li>–ù–µ —Å—Ç–æ–π—Ç–µ –ø–æ–¥ –º–æ—Å—Ç–∞–º–∏, –∞—Ä–∫–∞–º–∏, —Ä—è–¥–æ–º —Å —Ñ–∞—Å–∞–¥–∞–º–∏ –∏ –Ω–∞–≤–µ—Å–∞–º–∏.</li>
      </ul>

      <h4>4. –í–æ –≤—Ä–µ–º—è –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è ‚Äî –≤ –º–∞—à–∏–Ω–µ</h4>
      <ul>
        <li>–ê–∫–∫—É—Ä–∞—Ç–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –º–æ—Å—Ç–æ–≤, —ç—Å—Ç–∞–∫–∞–¥, –∑–¥–∞–Ω–∏–π –∏ –ª–∏–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ–ø–µ—Ä–µ–¥–∞—á.</li>
        <li>–û—Å—Ç–∞–Ω—å—Ç–µ—Å—å –ø—Ä–∏—Å—Ç—ë–≥–Ω—É—Ç—ã–º–∏ –≤ –º–∞—à–∏–Ω–µ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ–ª—á–∫–æ–≤.</li>
        <li>–í–∫–ª—é—á–∏—Ç–µ –∞–≤–∞—Ä–∏–π–Ω—É—é —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—é, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–ª—É—à–∞–π—Ç–µ —Ä–∞–¥–∏–æ –∏–ª–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è.</li>
      </ul>

      <h4>5. –ü–æ—Å–ª–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è</h4>
      <ul>
        <li>–ë—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ <strong>–ø–æ–≤—Ç–æ—Ä–Ω—ã–º —Ç–æ–ª—á–∫–∞–º (–∞—Ñ—Ç–µ—Ä—à–æ–∫–∞–º)</strong> –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–Ω–æ–≤–∞ —É–∫—Ä–æ–π—Ç–µ—Å—å.</li>
        <li>–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç–µ –Ω–∞—Ä—É–∂—É, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–µ–∫–ª–æ–º, –æ–±–ª–æ–º–∫–∞–º–∏ –∏ –æ–≥–æ–ª—ë–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∞–º–∏.</li>
        <li><strong>–ù–µ –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª–∏—Ñ—Ç–æ–º.</strong></li>
        <li>–ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –∑–∞–ø–∞—Ö –≥–∞–∑–∞ ‚Äî –Ω–µ –≤–∫–ª—é—á–∞–π—Ç–µ —Å–≤–µ—Ç –∏ –Ω–µ –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç—ã–º –æ–≥–Ω—ë–º, –ø–æ–∫–∏–Ω—å—Ç–µ –ø–æ–º–µ—â–µ–Ω–∏–µ –∏ —Å–æ–æ–±—â–∏—Ç–µ –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–ª—É–∂–±—ã.</li>
        <li>–ü–æ–º–æ–≥–∏—Ç–µ –¥–µ—Ç—è–º, –ø–æ–∂–∏–ª—ã–º –∏ —Ç–µ–º, –∫—Ç–æ —Ä–∞—Å—Ç–µ—Ä—è–ª—Å—è –∏–ª–∏ –≤ –ø–∞–Ω–∏–∫–µ.</li>
        <li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –∏ —É–∫–∞–∑–∞–Ω–∏—è–º–∏ –≤–ª–∞—Å—Ç–µ–π –ø–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—é –≤ –∑–¥–∞–Ω–∏—è.</li>
      </ul>

      <p><small>–≠—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–Ω—ã –¥–ª—è –æ–±—â–µ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏. –í—Å–µ–≥–¥–∞ —Å–ª–µ–¥—É–π—Ç–µ —É–∫–∞–∑–∞–Ω–∏—è–º –º–µ—Å—Ç–Ω—ã—Ö —Å–ª—É–∂–± –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</small></p>
    </div>
  </div>

  <!-- Location modal -->
  <div class="modal" id="locationModal">
    <div class="modal-header">
      <div class="modal-title">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div>
      <button class="modal-close" data-close-modal>&times;</button>
    </div>
    <div class="modal-body">
      <p>
        –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–∏—Ö –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π.
        –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ê–ª–º–∞—Ç—ã. –í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–ª–∏ –±—ã—Å—Ç—Ä–æ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –≥–æ—Ä–æ–¥–æ–≤.
      </p>

      <div class="location-form">
        <div class="location-form-row">
          <div class="field">
            <label for="latInput">–®–∏—Ä–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 43.2389)</label>
            <input id="latInput" type="number" step="0.0001" placeholder="–®–∏—Ä–æ—Ç–∞">
          </div>
          <div class="field">
            <label for="lonInput">–î–æ–ª–≥–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 76.8897)</label>
            <input id="lonInput" type="number" step="0.0001" placeholder="–î–æ–ª–≥–æ—Ç–∞">
          </div>
        </div>
        <div class="quick-cities">
          <button class="quick-city-btn" data-city="almaty">–ê–ª–º–∞—Ç—ã</button>
          <button class="quick-city-btn" data-city="astana">–ê—Å—Ç–∞–Ω–∞</button>
          <button class="quick-city-btn" data-city="tokyo">–¢–æ–∫–∏–æ</button>
          <button class="quick-city-btn" data-city="istanbul">–°—Ç–∞–º–±—É–ª</button>
          <button class="quick-city-btn" data-city="la">–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å</button>
        </div>
        <div class="location-actions">
          <button class="btn-secondary" id="detectIpBtn">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ IP</button>
          <button class="btn-primary" id="saveLocationBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  const USGS_URL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
  // –ü—Ä–∏–º–µ—Ä —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (EMSC / SeismicPortal). –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
  const EMSC_URL = "https://www.seismicportal.eu/fdsnws/event/1/query?limit=50&format=json";

  const DEFAULT_LOCATION = {
    lat: 43.2389,
    lon: 76.8897,
    label: "–ê–ª–º–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
  };

  let userLocation = { ...DEFAULT_LOCATION };
  let lastData = null;
  let refreshTimer = null;
  let refreshIntervalActive = 10000; // 10s
  let refreshIntervalInactive = 60000; // 60s
  let lastFetchError = null;

  const updatedTimeEl = document.getElementById("updatedTime");
  const eventsContainer = document.getElementById("eventsContainer");
  const statusMainEl = document.getElementById("statusMain");
  const statusPillEl = document.getElementById("statusPill");
  const statusPillTextEl = document.getElementById("statusPillText");
  const statusSubEl = document.getElementById("statusSub");
  const locationInfoEl = document.getElementById("locationInfo");

  const latInput = document.getElementById("latInput");
  const lonInput = document.getElementById("lonInput");
  const detectIpBtn = document.getElementById("detectIpBtn");
  const saveLocationBtn = document.getElementById("saveLocationBtn");

  // --------- Utils --------- //

  function formatTimeAgo(timestampMs) {
    const now = Date.now();
    const diffMs = now - timestampMs;
    if (diffMs < 0) return "—Ç–æ–ª—å–∫–æ —á—Ç–æ";
    const diffSec = Math.floor(diffMs / 1000);
    if (diffSec < 30) return "—Ç–æ–ª—å–∫–æ —á—Ç–æ";
    if (diffSec < 90) return "1 –º–∏–Ω –Ω–∞–∑–∞–¥";
    const diffMin = Math.floor(diffSec / 60);
    if (diffMin < 60) return diffMin + " –º–∏–Ω –Ω–∞–∑–∞–¥";
    const diffH = Math.floor(diffMin / 60);
    if (diffH < 24) return diffH + " —á –Ω–∞–∑–∞–¥";
    const diffD = Math.floor(diffH / 24);
    return diffD + " –¥–Ω –Ω–∞–∑–∞–¥";
  }

  function haversineKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const toRad = d => d * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
      Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function classifyDanger(mag, distanceKm) {
    if (mag == null || isNaN(mag) || isNaN(distanceKm)) {
      return { level: "low", label: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö", desc: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ü–µ–Ω–∫–∏." };
    }

    // –ü—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞
    if ((mag >= 5 && distanceKm <= 300) || (mag >= 4 && distanceKm <= 150)) {
      return {
        level: "high",
        label: "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ",
        desc: "–ï—Å—Ç—å –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—â—É—Ç–∏–º—ã–º–∏. –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã—Ö–æ–¥–∏—Ç–µ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–µ –º–µ—Å—Ç–æ."
      };
    }

    if ((mag >= 4 && distanceKm <= 500) || (mag >= 3.5 && distanceKm <= 300)) {
      return {
        level: "medium",
        label: "–ï—Å—Ç—å –æ—â—É—Ç–∏–º—ã–µ —Å–æ–±—ã—Ç–∏—è",
        desc: "–í –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –æ—â—É—Ç–∏–º—ã–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è. –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–∏—Ç—É–∞—Ü–∏–µ–π –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏."
      };
    }

    return {
      level: "low",
      label: "–°–ø–æ–∫–æ–π–Ω–æ",
      desc: "–û–ø–∞—Å–Ω—ã—Ö –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –ø–æ —Ç–µ–∫—É—â–∏–º –¥–∞–Ω–Ω—ã–º."
    };
  }

  function formatDistance(distanceKm) {
    if (!isFinite(distanceKm)) return "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
    if (distanceKm < 1) return "–ú–µ–Ω–µ–µ 1 –∫–º";
    if (distanceKm < 100) return distanceKm.toFixed(1) + " –∫–º";
    return Math.round(distanceKm / 10) * 10 + " –∫–º";
  }

  function setStatusFromEvents(events) {
    if (!events || !events.length) {
      statusMainEl.textContent = "–û–ø–∞—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ";
      statusPillEl.classList.remove("medium", "high");
      statusPillEl.classList.add("low");
      statusPillTextEl.textContent = "–°–ø–æ–∫–æ–π–Ω–æ";
      statusSubEl.textContent = "–ü–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–∞–Ω–Ω—ã–º —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –Ω–µ—Ç –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –æ–ø–∞—Å–Ω–æ—Å—Ç—å.";
      return;
    }
    // –±–µ—Ä—ë–º —Å–∞–º–æ–µ "–æ–ø–∞—Å–Ω–æ–µ" —Å–æ–±—ã—Ç–∏–µ
    let best = null;
    const weights = { high: 3, medium: 2, low: 1 };
    for (const ev of events) {
      const d = classifyDanger(ev.mag, ev.distanceKm);
      const w = weights[d.level] || 0;
      if (!best || w > best.w) best = { ...d, w, ev };
    }
    if (!best) return;

    statusPillEl.classList.remove("low", "medium", "high");
    statusPillEl.classList.add(best.level);
    statusPillTextEl.textContent = best.label;

    if (best.level === "high") {
      statusMainEl.textContent = "–ï—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ";
    } else if (best.level === "medium") {
      statusMainEl.textContent = "–í –±–ª–∏–∂–∞–π—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ –µ—Å—Ç—å –æ—â—É—Ç–∏–º—ã–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è";
    } else {
      statusMainEl.textContent = "–°–µ—Ä—å—ë–∑–Ω—ã—Ö —É–≥—Ä–æ–∑ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ";
    }

    statusSubEl.textContent = best.desc;
  }

  function renderEvents(events) {
    if (!events || !events.length) {
      eventsContainer.innerHTML = '<div class="empty-state">–ü–æ —Ç–µ–∫—É—â–∏–º –¥–∞–Ω–Ω—ã–º –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –Ω–µ—Ç –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ï—Å–ª–∏ –≤—ã –æ—â—É—â–∞–µ—Ç–µ —Ç–æ–ª—á–∫–∏ ‚Äî —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º.</div>';
      setStatusFromEvents([]);
      return;
    }

    const items = events.slice(0, 20);
    const fragments = items.map(ev => {
      const danger = classifyDanger(ev.mag, ev.distanceKm);
      const levelClass = danger.level;
      const colorLabel = danger.level === "high" ? "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å" :
                         danger.level === "medium" ? "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å" :
                         "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";

      const timeAgo = formatTimeAgo(ev.time);
      const magText = ev.mag != null ? "M " + ev.mag.toFixed(1) : "M ‚Äî";
      const distText = isFinite(ev.distanceKm)
        ? "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —ç–ø–∏—Ü–µ–Ω—Ç—Ä–∞ ~ " + formatDistance(ev.distanceKm)
        : "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —ç–ø–∏—Ü–µ–Ω—Ç—Ä–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";

      const regionText = ev.place || "–†–µ–≥–∏–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω";
      const srcText = ev.source || "–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ —É–∫–∞–∑–∞–Ω";

      const detailLink = ev.detailUrl
        ? `<a class="event-link" href="${ev.detailUrl}" target="_blank" rel="noopener noreferrer">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ</a>`
        : "";

      return `
        <div class="event-card ${levelClass}">
          <div class="event-danger-bar"></div>
          <div class="event-main-line">
            <span><span class="event-mag">${magText}</span> ¬∑ ${timeAgo}</span>
            <span class="event-time">${colorLabel}</span>
          </div>
          <div class="event-second-line">${distText}</div>
          <div class="event-third-line">${regionText}</div>
          <div class="event-links">
            <span class="event-source">${srcText}</span>
            ${detailLink}
          </div>
        </div>
      `;
    });

    eventsContainer.innerHTML = '<div class="events-list">' + fragments.join("") + '</div>';
    setStatusFromEvents(events);
  }

  function setUpdatedTime(date) {
    if (!date) {
      updatedTimeEl.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ‚Ä¶";
      return;
    }
    const d = new Date(date);
    const hh = d.getHours().toString().padStart(2, "0");
    const mm = d.getMinutes().toString().padStart(2, "0");
    const ss = d.getSeconds().toString().padStart(2, "0");
    updatedTimeEl.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ " + hh + ":" + mm + ":" + ss;
  }

  function setLocationInfo() {
    locationInfoEl.textContent = "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: " + (userLocation.label || "–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã " + userLocation.lat.toFixed(3) + ", " + userLocation.lon.toFixed(3));
    latInput.value = userLocation.lat.toFixed(4);
    lonInput.value = userLocation.lon.toFixed(4);
  }

  // -------- Fetchers -------- //

  async function fetchUSGS() {
    const res = await fetch(USGS_URL);
    if (!res.ok) throw new Error("USGS error: " + res.status);
    const data = await res.json();
    if (!data.features) return [];
    return data.features.map(f => {
      const props = f.properties || {};
      const coords = (f.geometry && f.geometry.coordinates) || [];
      const lon = coords[0];
      const lat = coords[1];
      const mag = props.mag;
      const time = props.time;
      const place = props.place;
      const url = props.url;
      const distanceKm = (lat != null && lon != null)
        ? haversineKm(userLocation.lat, userLocation.lon, lat, lon)
        : NaN;
      return {
        source: "USGS",
        mag,
        time,
        place,
        lat,
        lon,
        distanceKm,
        detailUrl: url || null
      };
    });
  }

  async function fetchEMSC() {
    const res = await fetch(EMSC_URL);
    if (!res.ok) throw new Error("EMSC error: " + res.status);
    const data = await res.json();
    const features = data.features || data.events || [];
    return features.map(f => {
      const props = f.properties || f;
      const coords = (f.geometry && f.geometry.coordinates) || [props.lon, props.lat];
      const lon = coords[0];
      const lat = coords[1];
      const mag = props.mag || props.magnitude;
      const time = props.time || (props.time_ms || Date.now());
      const place = props.flynn_region || props.region || "–†–µ–≥–∏–æ–Ω EMSC";
      const url = props.url || props.web || null;
      const distanceKm = (lat != null && lon != null)
        ? haversineKm(userLocation.lat, userLocation.lon, lat, lon)
        : NaN;
      return {
        source: "EMSC",
        mag: typeof mag === "number" ? mag : parseFloat(mag),
        time,
        place,
        lat,
        lon,
        distanceKm,
        detailUrl: url
      };
    });
  }

  async function fetchAll() {
    lastFetchError = null;
    try {
      let events = await fetchUSGS();
      if ((!events || !events.length) && navigator.onLine) {
        // –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤
        events = await fetchEMSC();
      }
      // —Ñ–∏–ª—å—Ç—Ä—É–µ–º –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–µ, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–ø–∞–ª–∏
      const now = Date.now();
      events = (events || []).filter(ev => now - ev.time <= 1000 * 60 * 60 * 3); // 3 —á–∞—Å–∞
      // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–Ω–∞—á–∞–ª–∞ —Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
      events.sort((a, b) => b.time - a.time);
      lastData = {
        updatedAt: now,
        events
      };
      renderEvents(events);
      setUpdatedTime(now);
    } catch (err) {
      console.error("Fetch error:", err);
      lastFetchError = err;
      setUpdatedTime(Date.now());
      if (lastData && lastData.events && lastData.events.length) {
        // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—ç—à –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
        renderEvents(lastData.events);
        const warning = document.createElement("div");
        warning.className = "error-state";
        warning.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü–æ–∫–∞–∑–∞–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ.";
        eventsContainer.prepend(warning);
      } else {
        eventsContainer.innerHTML = '<div class="error-state">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ.</div>';
        setStatusFromEvents([]);
      }
    }
  }

  function setupRefreshLoop() {
    if (refreshTimer) clearInterval(refreshTimer);
    const interval = document.visibilityState === "visible" ? refreshIntervalActive : refreshIntervalInactive;
    refreshTimer = setInterval(fetchAll, interval);
  }

  document.addEventListener("visibilitychange", () => {
    setupRefreshLoop();
  });

  // -------- Location via IP -------- //

  async function detectLocationFromIP() {
    try {
      // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π IP-–≥–µ–æ–ª–æ–∫–∞—Ç–æ—Ä. –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑ file:// –∏–ª–∏ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.
      const res = await fetch("https://ipapi.co/json/");
      if (!res.ok) throw new Error("ipapi error " + res.status);
      const data = await res.json();
      if (data && typeof data.latitude === "number" && typeof data.longitude === "number") {
        userLocation.lat = data.latitude;
        userLocation.lon = data.longitude;
        const city = data.city || "";
        const country = data.country_name || "";
        userLocation.label = city || country
          ? (city ? city : "") + (city && country ? ", " : "") + (country ? country : "")
          : "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –ø–æ IP";
        setLocationInfo();
        // –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
        if (lastData && lastData.events) {
          lastData.events.forEach(ev => {
            if (ev.lat != null && ev.lon != null) {
              ev.distanceKm = haversineKm(userLocation.lat, userLocation.lon, ev.lat, ev.lon);
            }
          });
          renderEvents(lastData.events);
        }
        return true;
      }
      throw new Error("no coords from IP");
    } catch (err) {
      console.warn("IP location failed:", err);
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ IP. –í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ê–ª–º–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.");
      return false;
    }
  }

  // -------- Modal logic -------- //

  const backdrop = document.getElementById("modalBackdrop");
  const modals = {
    howModal: document.getElementById("howModal"),
    safetyModal: document.getElementById("safetyModal"),
    locationModal: document.getElementById("locationModal")
  };

  function openModal(id) {
    if (!modals[id]) return;
    backdrop.dataset.activeModal = id;
    backdrop.classList.add("visible");
    Object.entries(modals).forEach(([key, el]) => {
      el.style.display = key === id ? "flex" : "none";
    });
  }

  function closeModal() {
    backdrop.classList.remove("visible");
    backdrop.dataset.activeModal = "";
  }

  document.addEventListener("click", (e) => {
    const openId = e.target.getAttribute("data-open-modal");
    if (openId) {
      openModal(openId);
      return;
    }
    if (e.target.hasAttribute("data-close-modal")) {
      closeModal();
      return;
    }
    if (e.target === backdrop) {
      closeModal();
    }
  });

  // -------- Location modal actions -------- //

  document.querySelectorAll(".quick-city-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const city = btn.dataset.city;
      let coords = null;
      switch (city) {
        case "almaty":
          coords = { lat: 43.2389, lon: 76.8897, label: "–ê–ª–º–∞—Ç—ã" }; break;
        case "astana":
          coords = { lat: 51.1605, lon: 71.4704, label: "–ê—Å—Ç–∞–Ω–∞" }; break;
        case "tokyo":
          coords = { lat: 35.6895, lon: 139.6917, label: "–¢–æ–∫–∏–æ" }; break;
        case "istanbul":
          coords = { lat: 41.0082, lon: 28.9784, label: "–°—Ç–∞–º–±—É–ª" }; break;
        case "la":
          coords = { lat: 34.0522, lon: -118.2437, label: "–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å" }; break;
      }
      if (coords) {
        latInput.value = coords.lat.toFixed(4);
        lonInput.value = coords.lon.toFixed(4);
      }
    });
  });

  detectIpBtn.addEventListener("click", async () => {
    await detectLocationFromIP();
  });

  saveLocationBtn.addEventListener("click", () => {
    const latVal = parseFloat(latInput.value);
    const lonVal = parseFloat(lonInput.value);
    if (!isFinite(latVal) || !isFinite(lonVal)) {
      alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —à–∏—Ä–æ—Ç—ã –∏ –¥–æ–ª–≥–æ—Ç—ã.");
      return;
    }
    userLocation.lat = latVal;
    userLocation.lon = lonVal;
    userLocation.label = "–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã " + latVal.toFixed(3) + ", " + lonVal.toFixed(3);
    setLocationInfo();
    // –ø–µ—Ä–µ—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
    if (lastData && lastData.events) {
      lastData.events.forEach(ev => {
        if (ev.lat != null && ev.lon != null) {
          ev.distanceKm = haversineKm(userLocation.lat, userLocation.lon, ev.lat, ev.lon);
        }
      });
      renderEvents(lastData.events);
    }
    closeModal();
  });

  // -------- Init -------- //

  function initLocation() {
    // –º–æ–∂–Ω–æ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤–∑—è—Ç—å –∏–∑ localStorage –≤ –±—É–¥—É—â–µ–º,
    // –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–µ—Ñ–æ–ª—Ç –ê–ª–º–∞—Ç—ã –∏ —Ä—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.
    userLocation = { ...DEFAULT_LOCATION };
    setLocationInfo();
  }

  async function init() {
    initLocation();
    setUpdatedTime(null);
    await fetchAll();
    setupRefreshLoop();
  }

  init();
})();
</script>
</body>
</html>
