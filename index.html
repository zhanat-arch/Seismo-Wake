<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Seismo-Wake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#111827" />
  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #0f172a;
      --bg-soft: #020617;
      --accent: #22c55e;
      --accent-soft: #16a34a33;
      --danger: #ef4444;
      --danger-soft: #ef444433;
      --warn: #f97316;
      --warn-soft: #f9731633;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --card-radius: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
    }

    .app-shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 32px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .logo-circle {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #ecfdf5;
      box-shadow: 0 0 24px #22c55e55;
      flex-shrink: 0;
    }

    .app-title-block h1 {
      font-size: 22px;
      margin: 0;
    }

    .app-title-block p {
      margin: 2px 0 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .lang-switch {
      display: flex;
      gap: 6px;
      margin: 10px 0 14px;
      flex-wrap: wrap;
    }

    .lang-btn {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-soft);
      font-size: 12px;
      cursor: pointer;
    }

    .lang-btn.active {
      border-color: var(--accent);
      background: #022c22;
      color: #bbf7d0;
    }

    h2.section-title {
      font-size: 17px;
      margin: 8px 0 6px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 12px;
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }

    .updated-label {
      font-size: 13px;
      color: var(--text-soft);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text);
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #15803d);
      border-color: #22c55e;
      color: #052e16;
      font-weight: 600;
    }

    .btn-ghost {
      background: transparent;
    }

    .region-label {
      font-size: 14px;
      margin: 6px 0 12px;
    }

    .region-label span {
      color: #a5f3fc;
    }

    .live-row-title {
      font-size: 15px;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 6px;
    }

    .location-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .location-input-wrapper {
      flex: 1 1 200px;
      min-width: 0;
    }

    #location-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text);
      font-size: 14px;
    }

    #location-input::placeholder {
      color: #6b7280;
    }

    .small-note {
      font-size: 12px;
      color: var(--text-soft);
    }

    .small-link-btn {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: #bfdbfe;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .small-link-btn a {
      color: inherit;
      text-decoration: none;
    }

    .cards-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .card {
      border-radius: var(--card-radius);
      background: linear-gradient(135deg, #020617, #020617);
      border: 1px solid var(--border-soft);
      padding: 10px 12px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .event-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .event-card {
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px solid var(--border-soft);
      background: #020617;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 13px;
    }

    .event-card.level-low {
      border-left: 4px solid #22c55e;
      background: linear-gradient(90deg, #022c22, #020617);
    }

    .event-card.level-medium {
      border-left: 4px solid #f97316;
      background: linear-gradient(90deg, #431407, #020617);
    }

    .event-card.level-high {
      border-left: 4px solid #ef4444;
      background: linear-gradient(90deg, #450a0a, #020617);
    }

    .event-main-line {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .event-location {
      font-weight: 500;
      font-size: 13px;
    }

    .event-mag {
      font-weight: 700;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-soft);
    }

    .pill-ago {
      border-color: #4b5563;
    }

    .pill-distance {
      border-color: #38bdf8;
      color: #bae6fd;
    }

    .pill-depth {
      border-color: #a855f7;
      color: #e9d5ff;
    }

    .pill-mag-low {
      border-color: #22c55e;
      color: #bbf7d0;
    }

    .pill-mag-medium {
      border-color: #f97316;
      color: #fed7aa;
    }

    .pill-mag-high {
      border-color: #ef4444;
      color: #fecaca;
    }

    .footer-note {
      margin-top: 16px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .footer-note a {
      color: #93c5fd;
      text-decoration: none;
    }

    .footer-note a:hover {
      text-decoration: underline;
    }

    .warning-banner {
      border-radius: 14px;
      padding: 10px 12px;
      margin-top: 8px;
      font-size: 13px;
      display: none;
    }

    .warning-banner.level-info {
      background: #022c22;
      border: 1px solid #16a34a;
      color: #bbf7d0;
    }

    .warning-banner.level-warning {
      background: #431407;
      border: 1px solid #f97316;
      color: #fed7aa;
    }

    .warning-banner.level-danger {
      background: #450a0a;
      border: 1px solid #ef4444;
      color: #fecaca;
    }

    .warning-title {
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .warning-body {
      margin-bottom: 4px;
    }

    .warning-extra {
      font-size: 12px;
      opacity: 0.9;
    }

    .safety-btn-inline {
      margin-top: 6px;
    }

    .safety-btn-inline .btn {
      font-size: 11px;
      padding: 5px 9px;
    }

    /* Modals */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: #020617dd;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal {
      max-width: 480px;
      width: calc(100% - 32px);
      max-height: calc(100% - 40px);
      border-radius: 18px;
      background: #020617;
      border: 1px solid var(--border-soft);
      padding: 14px 14px 16px;
      overflow-y: auto;
      box-shadow: 0 18px 45px #000000aa;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .modal-title {
      font-size: 15px;
      font-weight: 600;
    }

    .modal-close {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #020617;
      color: var(--text-soft);
      cursor: pointer;
      font-size: 14px;
    }

    .modal-body {
      font-size: 13px;
      color: var(--text-soft);
    }

    .modal-body p {
      margin: 4px 0;
    }

    .modal-body ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    .modal-body li {
      margin-bottom: 3px;
    }

    .donate-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    .donate-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: #fecaca;
      text-decoration: none;
      font-size: 13px;
    }

    .donate-btn.primary {
      background: linear-gradient(135deg, #f97316, #b91c1c);
      border-color: #f97316;
      color: #1f2937;
      font-weight: 600;
    }

    .donate-btn span.heart {
      font-size: 15px;
    }

    @media (min-width: 640px) {
      .btn-row {
        justify-content: flex-start;
      }
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 20px 24px 32px;
      }

      header {
        margin-bottom: 10px;
      }

      .app-title-block h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="logo-circle">SW</div>
      <div class="app-title-block">
        <h1>Seismo-Wake</h1>
        <p>–†–∞–Ω–Ω–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –≥–¥–µ –∏ –∫–∞–∫ –¥–∞–ª–µ–∫–æ –±—ã–ª–∏ —Ç–æ–ª—á–∫–∏ —Ä—è–¥–æ–º —Å –≤–∞–º–∏</p>
      </div>
    </header>

    <div class="lang-switch">
      <button class="lang-btn active" data-lang="ru">RU</button>
      <button class="lang-btn" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="kz">KZ</button>
      <button class="lang-btn" data-lang="fr">FR</button>
    </div>

    <h2 class="section-title">–û–Ω–ª–∞–π–Ω-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
    <div class="top-row">
      <div class="updated-label" id="updated-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" id="btn-refresh">‚ö° –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button class="btn btn-ghost" id="btn-install">‚¨áÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
      <button class="btn" id="btn-donate">‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
      <button class="btn" id="btn-how">‚ùì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</button>
    </div>

    <div class="region-label" id="region-label">–í–∞—à —Ä–µ–≥–∏–æ–Ω: <span>‚Äî</span></div>

    <div id="warning-banner" class="warning-banner">
      <div class="warning-title" id="warning-title"></div>
      <div class="warning-body" id="warning-body"></div>
      <div class="warning-extra" id="warning-extra"></div>
      <div class="safety-btn-inline">
        <button class="btn btn-ghost" id="btn-open-safety">üìã –ö–∞–∫ —Å–µ–±—è –≤–µ—Å—Ç–∏</button>
      </div>
    </div>

    <div class="live-row-title">–í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>

    <div class="location-row">
      <div class="location-input-wrapper">
        <input id="location-input" list="city-list" placeholder="–ì–æ—Ä–æ–¥ –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω (Almaty, Astana, Urumqi‚Ä¶)" />
        <datalist id="city-list"></datalist>
      </div>
      <button class="btn" id="btn-use-geo">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
    </div>

    <div class="location-row">
      <span class="small-note" id="city-hint">
        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ —Å—Ç–æ–ª–∏—Ü—ã. –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
      </span>
    </div>

    <div class="location-row">
      <button class="small-link-btn" id="btn-open-online">
        üîó –û—Ç–∫—Ä—ã—Ç—å –æ–Ω–ª–∞–π–Ω-–≤–µ—Ä—Å–∏—é
      </button>
    </div>

    <div class="cards-column">
      <section class="card">
        <div class="card-header">
          <div class="card-title">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–∏–º–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏</div>
        </div>
        <div id="last-significant" class="event-list small-note">
          –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª.
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏</div>
        </div>
        <div id="near-hour" class="event-list small-note">
          –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏.
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">‚è±Ô∏è –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏</div>
        </div>
        <div id="near-day" class="event-list small-note">
          –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏.
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏</div>
        </div>
        <div id="near-week" class="event-list small-note">
          –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏.
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">–°–∏–ª—å–Ω—ã–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –≤ –º–∏—Ä–µ (24 —á–∞—Å–∞)</div>
        </div>
        <div id="world-strong" class="event-list small-note">
          –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª.
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div class="card-title">üìã –ü–∞–º—è—Ç–∫–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
        </div>
        <div class="card-sub">–ö—Ä–∞—Ç–∫–æ –æ —Ç–æ–º, –∫–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø—Ä–∏ –æ—â—É—Ç–∏–º—ã—Ö —Ç–æ–ª—á–∫–∞—Ö.</div>
        <div style="margin-top: 8px;">
          <button class="btn btn-ghost" id="btn-safety-main">–ö–∞–∫ —Å–µ–±—è –≤–µ—Å—Ç–∏ –ø—Ä–∏ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–∏</button>
        </div>
      </section>
    </div>

    <div class="footer-note">
      –í–∞–∂–Ω–æ: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.
      <br />
      –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞: <a href="https://github.com/zhanat-arch/Seismo-Wake" target="_blank" rel="noopener noreferrer">GitHub / Seismo-Wake</a>.
    </div>
  </div>

  <!-- –ó–≤—É–∫ —Ç—Ä–µ–≤–æ–≥–∏: –ø–æ–ª–æ–∂–∏ —Ä—è–¥–æ–º —Å index.html —Ñ–∞–π–ª alert.mp3 (–∫–æ—Ä–æ—Ç–∫–∏–π ¬´–ø–∏–∫-–ø–∏–∫¬ª) -->
  <audio id="alertAudio" preload="auto">
    <source src="alert.mp3" type="audio/mpeg" />
  </audio>

  <!-- –ú–æ–¥–∞–ª: –¥–æ–Ω–∞—Ç -->
  <div id="modal-donate-backdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å Seismo-Wake</div>
        <button class="modal-close" data-close-modal="donate">‚úï</button>
      </div>
      <div class="modal-body">
        <p>
          –í–∞—à –¥–æ–Ω–∞—Ç –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å Seismo-Wake, —É–ª—É—á—à–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –¥–µ–ª–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–ª—á–∫–æ–≤ –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –Ω–∞–≥–ª—è–¥–Ω—ã–º.
          –î–∞–∂–µ –Ω–µ–±–æ–ª—å—à–∞—è —Å—É–º–º–∞ –≤–∞–∂–Ω–∞.
        </p>
        <div class="donate-actions">
          <a class="donate-btn primary" href="https://boosty.to/zhanat-arch" target="_blank" rel="noopener noreferrer">
            <span class="heart">‚ù§Ô∏è</span> –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π (Boosty)
          </a>
          <a class="donate-btn" href="https://ko-fi.com/zhanat_arch" target="_blank" rel="noopener noreferrer">
            ‚òï –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —á–µ—Ä–µ–∑ PayPal / Ko-fi
          </a>
        </div>
        <p style="margin-top:8px;">
          Boosty –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞—Ä—Ç—ã –∏–∑ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω. Ko-fi —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å PayPal –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ.
        </p>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç -->
  <div id="modal-how-backdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Seismo-Wake</div>
        <button class="modal-close" data-close-modal="how">‚úï</button>
      </div>
      <div class="modal-body">
        <p>
          Seismo-Wake ‚Äî —ç—Ç–æ –ª—ë–≥–∫–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
          —Å–æ–±—ã—Ç–∏—è –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –∏ –ø–æ –º–∏—Ä—É.
        </p>
        <p>
          –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–π HTML-—Ñ–∞–π–ª –∏ –∫–∞–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (PWA), —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ
          –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞.
        </p>

        <p><strong>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</strong></p>
        <ul>
          <li>–°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ GPS (–µ—Å–ª–∏ –≤—ã —Ä–∞–∑—Ä–µ—à–∏–ª–∏ –¥–æ—Å—Ç—É–ø).</li>
          <li>–ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç, –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –≤—Ä—É—á–Ω—É—é –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤.</li>
          <li>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —ç–ø–∏—Ü–µ–Ω—Ç—Ä–æ–≤.</li>
        </ul>

        <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</strong></p>
        <ul>
          <li>–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª.</li>
          <li>–ü–æ–∫–∞ –≤–∫–ª–∞–¥–∫–∞ —Å Seismo-Wake –æ—Ç–∫—Ä—ã—Ç–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.</li>
          <li>
            –ü—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—å–Ω–æ–º —Å–æ–±—ã—Ç–∏–∏ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–¥–µ–ª—è–µ—Ç –µ–≥–æ —Ü–≤–µ—Ç–æ–º –∏ –º–æ–∂–µ—Ç –ø–æ–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª, —á—Ç–æ–±—ã –≤—ã –æ–±—Ä–∞—Ç–∏–ª–∏
            –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω.
          </li>
        </ul>

        <p><strong>–û–Ω–ª–∞–π–Ω-–≤–µ—Ä—Å–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</strong></p>
        <ul>
          <li>–°–∞–º–∞—è —Å–≤–µ–∂–∞—è –≤–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: <code>https://zhanat-arch.github.io/Seismo-Wake/</code>.</li>
          <li>–õ–æ–∫–∞–ª—å–Ω—ã–π HTML –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑ GitHub, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</li>
        </ul>

        <p>
          –í–∞–∂–Ω–æ: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ–ø–æ–≤–µ—â–µ–Ω–∏—è. –ü—Ä–∏ –æ—â—É—Ç–∏–º—ã—Ö —Ç–æ–ª—á–∫–∞—Ö –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ú–ß–°
          –∏ –º–µ—Å—Ç–Ω—ã—Ö —Å–ª—É–∂–±.
        </p>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª: –ø–∞–º—è—Ç–∫–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
  <div id="modal-safety-backdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Ô∏è–ö–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø—Ä–∏ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–∏</div>
        <button class="modal-close" data-close-modal="safety">‚úï</button>
      </div>
      <div class="modal-body">
        <p><strong>–í–æ –≤—Ä–µ–º—è –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è</strong></p>
        <ul>
          <li>–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ. –ù–µ –±–µ–≥–∏—Ç–µ –∫ –≤—ã—Ö–æ–¥—É, –µ—Å–ª–∏ —Ç–æ–ª—á–∫–∏ —É–∂–µ —Å–∏–ª—å–Ω—ã–µ.</li>
          <li>–î–µ—Ä–∂–∏—Ç–µ—Å—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –æ–∫–æ–Ω, —Å—Ç–µ–∫–ª–∞, —Ç—è–∂—ë–ª—ã—Ö —à–∫–∞—Ñ–æ–≤ –∏ –ø–æ–¥–≤–µ—Å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.</li>
          <li>
            –ï—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ä–∏–≥–µ–ª–∏ –∏–ª–∏ –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã, –≤—Å—Ç–∞–Ω—å—Ç–µ —Ä—è–¥–æ–º —Å –Ω–∏–º–∏, –Ω–æ –Ω–µ –ø–æ–¥ —Å–∞–º–∏–º —à–∫–∞—Ñ–æ–º –∏–ª–∏ —Å—Ç–µ–∫–ª–æ–º.
          </li>
          <li>–ï—Å–ª–∏ –≤—ã –Ω–∞ —É–ª–∏—Ü–µ ‚Äî –æ—Ç—Ö–æ–¥–∏—Ç–µ –æ—Ç –∑–¥–∞–Ω–∏–π, –≤–∏—Ç—Ä–∏–Ω, —Å—Ç–æ–ª–±–æ–≤ –∏ –ø—Ä–æ–≤–æ–¥–æ–≤.</li>
        </ul>

        <p><strong>–ü–æ—Å–ª–µ —Ç–æ–ª—á–∫–æ–≤</strong></p>
        <ul>
          <li>–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–º–µ—â–µ–Ω–∏–µ. –ù–µ –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ª–∏—Ñ—Ç–æ–º, –≤—ã–±–∏—Ä–∞–π—Ç–µ—Å—å –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ.</li>
          <li>–ü—Ä–∏ –∑–∞–ø–∞—Ö–µ –≥–∞–∑–∞ –∏–ª–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ —É—Ç–µ—á–∫—É ‚Äî –ø–µ—Ä–µ–∫—Ä–æ–π—Ç–µ –≥–∞–∑ (–µ—Å–ª–∏ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ) –∏ –≤—ã—Ö–æ–¥–∏—Ç–µ –Ω–∞ —É–ª–∏—Ü—É.</li>
          <li>–ë—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º —Ç–æ–ª—á–∫–∞–º, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å —Å—Ä–∞–∑—É –ø–æ–¥ —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.</li>
        </ul>

        <p><strong>–ï—Å–ª–∏ –≤—ã –¥–æ–º–∞</strong></p>
        <ul>
          <li>–ù–µ —Å—Ç–æ–π—Ç–µ –≤ –ª—ë–≥–∫–æ–º –¥–≤–µ—Ä–Ω–æ–º –ø—Ä–æ—ë–º–µ, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –Ω–µ—Å—É—â–∞—è —Å—Ç–µ–Ω–∞.</li>
          <li>–ó–∞–∫—Ä–æ–π—Ç–µ –≥–∞–∑, –≤—ã–∫–ª—é—á–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç–æ–µ –ø–ª–∞–º—è, –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ —ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–∏–±–æ—Ä—ã.</li>
          <li>–î–µ—Ä–∂–∏—Ç–µ —Ä—è–¥–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≤–æ–¥—É –∏ –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –≤–µ—â–µ–π –Ω–∞ —Å–ª—É—á–∞–π —ç–≤–∞–∫—É–∞—Ü–∏–∏.</li>
        </ul>

        <p><strong>–ï—Å–ª–∏ –≤—ã –Ω–∞ —É–ª–∏—Ü–µ –∏–ª–∏ –≤ –º–∞—à–∏–Ω–µ</strong></p>
        <ul>
          <li>–û—Ç–æ–π–¥–∏—Ç–µ –æ—Ç —Ñ–∞—Å–∞–¥–æ–≤ –∑–¥–∞–Ω–∏–π, –º–æ—Å—Ç–æ–≤, —Ç–æ–Ω–Ω–µ–ª–µ–π –∏ –ª–∏–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ–ø–µ—Ä–µ–¥–∞—á–∏.</li>
          <li>–í –º–∞—à–∏–Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –≤–¥–∞–ª–∏ –æ—Ç –ø—É—Ç–µ–ø—Ä–æ–≤–æ–¥–æ–≤ –∏ –∑–¥–∞–Ω–∏–π –∏ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ–ª—á–∫–æ–≤.</li>
        </ul>

        <p>–≠—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–æ—Å—è—Ç –æ–±—â–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª—É–∂–±.</p>
      </div>
    </div>
  </div>

  <script>
    // --- –ü—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å) ---
    const CITY_DB = [
      { name: "Almaty, Kazakhstan", lat: 43.238949, lon: 76.889709 },
      { name: "Astana, Kazakhstan", lat: 51.160523, lon: 71.470356 },
      { name: "Shymkent, Kazakhstan", lat: 42.3417, lon: 69.5901 },
      { name: "Urumqi, China", lat: 43.8256, lon: 87.6168 },
      { name: "Bishkek, Kyrgyzstan", lat: 42.8746, lon: 74.5698 },
      { name: "Tashkent, Uzbekistan", lat: 41.2995, lon: 69.2401 },
      { name: "Dushanbe, Tajikistan", lat: 38.5598, lon: 68.7870 },
      { name: "Moscow, Russia", lat: 55.7558, lon: 37.6173 },
      { name: "Istanbul, T√ºrkiye", lat: 41.0082, lon: 28.9784 },
      { name: "Tokyo, Japan", lat: 35.6762, lon: 139.6503 },
      { name: "Los Angeles, USA", lat: 34.0522, lon: -118.2437 },
      { name: "San Francisco, USA", lat: 37.7749, lon: -122.4194 },
      { name: "Santiago, Chile", lat: -33.4489, lon: -70.6693 },
      { name: "Mexico City, Mexico", lat: 19.4326, lon: -99.1332 },
      { name: "Tehran, Iran", lat: 35.6892, lon: 51.3890 },
      { name: "Yerevan, Armenia", lat: 40.1792, lon: 44.4991 }
    ];

    const DEFAULT_LOCATION = CITY_DB[0]; // Almaty –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    let userLocation = {
      name: DEFAULT_LOCATION.name,
      lat: DEFAULT_LOCATION.lat,
      lon: DEFAULT_LOCATION.lon,
      source: "default" // default | gps | manual
    };

    let lastFetchRawEvents = [];
    let autoRefreshTimer = null;
    const AUTO_REFRESH_MS = 10000; // 10 —Å–µ–∫—É–Ω–¥
    const EARTHQUAKE_FEED =
      "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson";

    const updatedLabelEl = document.getElementById("updated-label");
    const regionLabelEl = document.getElementById("region-label").querySelector("span");
    const lastSignificantEl = document.getElementById("last-significant");
    const nearHourEl = document.getElementById("near-hour");
    const nearDayEl = document.getElementById("near-day");
    const nearWeekEl = document.getElementById("near-week");
    const worldStrongEl = document.getElementById("world-strong");
    const warningBannerEl = document.getElementById("warning-banner");
    const warningTitleEl = document.getElementById("warning-title");
    const warningBodyEl = document.getElementById("warning-body");
    const warningExtraEl = document.getElementById("warning-extra");
    const cityInputEl = document.getElementById("location-input");
    const cityListEl = document.getElementById("city-list");
    const alertAudioEl = document.getElementById("alertAudio");

    function initCityDatalist() {
      CITY_DB.forEach((c) => {
        const opt = document.createElement("option");
        opt.value = c.name;
        cityListEl.appendChild(opt);
      });
    }

    function updateRegionLabel() {
      regionLabelEl.textContent = userLocation.name || "‚Äî";
    }

    function formatAgo(timestampMs) {
      if (!timestampMs) return "‚Äî";
      const now = Date.now();
      const diffMs = now - timestampMs;
      if (diffMs < 0) return "—Ç–æ–ª—å–∫–æ —á—Ç–æ";
      const minutes = Math.floor(diffMs / 60000);
      if (minutes < 1) return "—Ç–æ–ª—å–∫–æ —á—Ç–æ";
      if (minutes < 60) return minutes + " –º–∏–Ω –Ω–∞–∑–∞–¥";
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + " —á –Ω–∞–∑–∞–¥";
      const days = Math.floor(hours / 24);
      return days + " –¥–Ω –Ω–∞–∑–∞–¥";
    }

    function formatLocalTime(timestampMs) {
      const d = new Date(timestampMs);
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${day}.${m}.${y} ${hh}:${mm}`;
    }

    function haversineDistanceKm(lat1, lon1, lat2, lon2) {
      function toRad(x) {
        return (x * Math.PI) / 180;
      }
      const R = 6371;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRad(lat1)) *
          Math.cos(toRad(lat2)) *
          Math.sin(dLon / 2) *
          Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function classifyLevel(mag, distanceKm) {
      if (mag == null) return "low";
      if (mag >= 6) return "high";
      if (mag >= 5) return "medium";
      if (mag >= 4 && distanceKm < 300) return "medium";
      return "low";
    }

    function magPillClass(level) {
      if (level === "high") return "pill-mag-high";
      if (level === "medium") return "pill-mag-medium";
      return "pill-mag-low";
    }

    function playAlertBeep() {
      if (!alertAudioEl) return;
      try {
        alertAudioEl.currentTime = 0;
        alertAudioEl.play().catch(() => {});
      } catch (e) {
        console.log("alert sound error", e);
      }
    }

    function checkForDangerEvent(events) {
      if (!events || !events.length) {
        warningBannerEl.style.display = "none";
        return;
      }
      const now = Date.now();
      const MAX_MINUTES = 15;
      const MAX_DISTANCE_KM = 2000;
      const MIN_MAG = 4.8;

      let candidate = null;

      for (const ev of events) {
        if (typeof ev.mag !== "number") continue;
        if (ev.distanceKm == null) continue;
        const minutesAgo = (now - ev.time) / 60000;
        if (minutesAgo > MAX_MINUTES) continue;
        if (ev.distanceKm > MAX_DISTANCE_KM) continue;
        if (ev.mag < MIN_MAG) continue;
        if (!candidate || ev.mag > candidate.mag) {
          candidate = ev;
        }
      }

      if (!candidate) {
        warningBannerEl.style.display = "none";
        return;
      }

      const minutesAgo = (now - candidate.time) / 60000;
      const level = candidate.mag >= 6 ? "danger" : "warning";
      const levelClass =
        level === "danger"
          ? "level-danger"
          : level === "warning"
          ? "level-warning"
          : "level-info";

      warningBannerEl.className = `warning-banner ${levelClass}`;
      warningTitleEl.textContent =
        level === "danger"
          ? "–°–∏–ª—å–Ω–æ–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏!"
          : "–í–æ–∑–º–æ–∂–Ω—ã –æ—â—É—Ç–∏–º—ã–µ —Ç–æ–ª—á–∫–∏ –≤ —Ä–µ–≥–∏–æ–Ω–µ.";
      warningBodyEl.textContent = `–ú–∞–≥–Ω–∏—Ç—É–¥–∞ M${candidate.mag.toFixed(
        1
      )}, –æ–∫–æ–ª–æ ${Math.round(candidate.distanceKm)} –∫–º –æ—Ç –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.`;

      warningExtraEl.textContent =
        "–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –¥–µ—Ä–∂–∏—Ç–µ—Å—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç —Å—Ç–µ–∫–ª–∞ –∏ —Ç—è–∂—ë–ª—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ú–ß–°.";

      warningBannerEl.style.display = "block";

      // –ó–≤—É–∫
      playAlertBeep();
    }

    function renderEvents(groupId, events, emptyText) {
      const container =
        groupId === "last-significant"
          ? lastSignificantEl
          : groupId === "near-hour"
          ? nearHourEl
          : groupId === "near-day"
          ? nearDayEl
          : groupId === "near-week"
          ? nearWeekEl
          : worldStrongEl;

      container.innerHTML = "";

      if (!events || !events.length) {
        container.textContent = emptyText;
        return;
      }

      for (const ev of events) {
        const level = classifyLevel(ev.mag, ev.distanceKm);
        const magCls = magPillClass(level);
        const card = document.createElement("div");
        card.className = `event-card level-${level}`;

        const main = document.createElement("div");
        main.className = "event-main-line";

        const locSpan = document.createElement("div");
        locSpan.className = "event-location";
        locSpan.textContent = ev.place || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–≥–∏–æ–Ω";

        const magSpan = document.createElement("div");
        magSpan.className = "event-mag";
        magSpan.textContent = `M${ev.mag != null ? ev.mag.toFixed(1) : "‚Äî"}`;

        main.appendChild(locSpan);
        main.appendChild(magSpan);

        const pillsRow = document.createElement("div");
        pillsRow.style.marginTop = "2px";
        pillsRow.style.display = "flex";
        pillsRow.style.flexWrap = "wrap";
        pillsRow.style.gap = "4px";

        const pillAgo = document.createElement("span");
        pillAgo.className = "pill pill-ago";
        pillAgo.textContent = formatAgo(ev.time);
        pillsRow.appendChild(pillAgo);

        if (ev.distanceKm != null) {
          const pillDist = document.createElement("span");
          pillDist.className = "pill pill-distance";
          pillDist.textContent = `${Math.round(ev.distanceKm)} –∫–º`;
          pillsRow.appendChild(pillDist);
        }

        if (ev.depthKm != null) {
          const pillDepth = document.createElement("span");
          pillDepth.className = "pill pill-depth";
          pillDepth.textContent = `–ì–ª—É–±–∏–Ω–∞ ${Math.round(ev.depthKm)} –∫–º`;
          pillsRow.appendChild(pillDepth);
        }

        const pillMag = document.createElement("span");
        pillMag.className = `pill ${magCls}`;
        pillMag.textContent = `M${ev.mag != null ? ev.mag.toFixed(1) : "‚Äî"}`;
        pillsRow.appendChild(pillMag);

        const timeRow = document.createElement("div");
        timeRow.style.fontSize = "11px";
        timeRow.style.color = "#9ca3af";
        timeRow.textContent = formatLocalTime(ev.time);

        card.appendChild(main);
        card.appendChild(pillsRow);
        card.appendChild(timeRow);

        container.appendChild(card);
      }
    }

    async function fetchEarthquakes() {
      const ts = new Date();
      updatedLabelEl.textContent =
        "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " +
        ts.toLocaleDateString() +
        " " +
        ts.toLocaleTimeString().slice(0, 5);

      try {
        const res = await fetch(EARTHQUAKE_FEED);
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const data = await res.json();

        const events = (data.features || []).map((f) => {
          const props = f.properties || {};
          const geom = f.geometry || {};
          const coords = geom.coordinates || [];
          const lon = coords[0];
          const lat = coords[1];
          const depthKm = coords[2];
          const time = props.time;
          const mag = props.mag;
          const place = props.place;
          let distanceKm = null;
          if (
            typeof lat === "number" &&
            typeof lon === "number" &&
            typeof userLocation.lat === "number" &&
            typeof userLocation.lon === "number"
          ) {
            distanceKm = haversineDistanceKm(
              userLocation.lat,
              userLocation.lon,
              lat,
              lon
            );
          }
          return {
            id: f.id || `${time}-${lat}-${lon}`,
            time,
            mag,
            depthKm,
            place,
            distanceKm
          };
        });

        lastFetchRawEvents = events;
        groupAndRenderEvents(events);
      } catch (e) {
        console.error("Earthquake fetch failed", e);
        lastSignificantEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
        nearHourEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
        nearDayEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
        nearWeekEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
        worldStrongEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
        warningBannerEl.style.display = "none";
      }
    }

    function groupAndRenderEvents(events) {
      const now = Date.now();
      const NEAR_RADIUS_KM = 2000;

      const nearEvents = events.filter(
        (ev) =>
          ev.distanceKm != null && ev.distanceKm <= NEAR_RADIUS_KM && ev.time
      );

      const nearWeek = nearEvents.filter(
        (ev) => now - ev.time <= 7 * 24 * 60 * 60 * 1000
      );
      const nearDay = nearEvents.filter(
        (ev) => now - ev.time <= 24 * 60 * 60 * 1000
      );
      const nearHour = nearEvents.filter(
        (ev) => now - ev.time <= 60 * 60 * 1000
      );

      nearHour.sort((a, b) => b.time - a.time);
      nearDay.sort((a, b) => b.time - a.time);
      nearWeek.sort((a, b) => b.time - a.time);

      const byId = new Set(nearHour.map((e) => e.id));
      const dayOnly = nearDay.filter((e) => !byId.has(e.id));
      dayOnly.splice(5);
      const weekOnly = nearWeek.filter(
        (e) => !byId.has(e.id) && !dayOnly.find((d) => d.id === e.id)
      );
      weekOnly.splice(5);

      const lastSig = [...nearWeek].sort((a, b) => b.mag - a.mag)[0];

      if (lastSig) {
        renderEvents("last-significant", [lastSig], "");
      } else {
        renderEvents(
          "last-significant",
          [],
          "–†—è–¥–æ–º –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ –∑–Ω–∞—á–∏–º—ã—Ö —Å–æ–±—ã—Ç–∏–π."
        );
      }

      renderEvents(
        "near-hour",
        nearHour.slice(0, 5),
        "–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏."
      );
      renderEvents(
        "near-day",
        dayOnly,
        "–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏."
      );
      renderEvents(
        "near-week",
        weekOnly,
        "–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏."
      );

      const worldStrong = events
        .filter(
          (ev) =>
            typeof ev.mag === "number" &&
            ev.mag >= 5.5 &&
            now - ev.time <= 24 * 60 * 60 * 1000
        )
        .sort((a, b) => b.mag - a.mag)
        .slice(0, 10);

      renderEvents(
        "world-strong",
        worldStrong,
        "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Å–∏–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (M5.5+) –ø–æ –¥–∞–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞."
      );

      checkForDangerEvent(nearEvents);
    }

    function startAutoRefresh() {
      if (autoRefreshTimer) clearInterval(autoRefreshTimer);
      autoRefreshTimer = setInterval(fetchEarthquakes, AUTO_REFRESH_MS);
    }

    function handleCityInputChange() {
      const value = (cityInputEl.value || "").trim();
      if (!value) return;
      const valLower = value.toLowerCase();

      let best = null;
      let bestScore = 0;

      for (const c of CITY_DB) {
        const nameLower = c.name.toLowerCase();
        if (nameLower === valLower) {
          best = c;
          bestScore = 1000;
          break;
        }
        if (nameLower.includes(valLower)) {
          const score = valLower.length / nameLower.length;
          if (score > bestScore) {
            bestScore = score;
            best = c;
          }
        }
      }

      if (best) {
        userLocation = {
          name: best.name,
          lat: best.lat,
          lon: best.lon,
          source: "manual"
        };
        updateRegionLabel();
        if (lastFetchRawEvents.length) {
          groupAndRenderEvents(lastFetchRawEvents);
        }
      }
    }

    function initLangSwitch() {
      const langButtons = document.querySelectorAll(".lang-btn");
      langButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          langButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          // –ü–æ–∫–∞ —Ç–µ–∫—Å—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º; –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –±—É–¥—É—â–µ–µ
        });
      });
    }

    function showModal(name) {
      const id =
        name === "donate"
          ? "modal-donate-backdrop"
          : name === "how"
          ? "modal-how-backdrop"
          : "modal-safety-backdrop";
      const el = document.getElementById(id);
      if (el) el.style.display = "flex";
    }

    function hideModal(name) {
      const id =
        name === "donate"
          ? "modal-donate-backdrop"
          : name === "how"
          ? "modal-how-backdrop"
          : "modal-safety-backdrop";
      const el = document.getElementById(id);
      if (el) el.style.display = "none";
    }

    function initModals() {
      document.getElementById("btn-donate").addEventListener("click", () =>
        showModal("donate")
      );
      document.getElementById("btn-how").addEventListener("click", () =>
        showModal("how")
      );
      document.getElementById("btn-safety-main").addEventListener("click", () =>
        showModal("safety")
      );
      document
        .getElementById("btn-open-safety")
        .addEventListener("click", () => showModal("safety"));

      document.querySelectorAll(".modal-close").forEach((btn) => {
        const name = btn.getAttribute("data-close-modal");
        btn.addEventListener("click", () => hideModal(name));
      });

      document
        .getElementById("modal-donate-backdrop")
        .addEventListener("click", (e) => {
          if (e.target.id === "modal-donate-backdrop") hideModal("donate");
        });
      document
        .getElementById("modal-how-backdrop")
        .addEventListener("click", (e) => {
          if (e.target.id === "modal-how-backdrop") hideModal("how");
        });
      document
        .getElementById("modal-safety-backdrop")
        .addEventListener("click", (e) => {
          if (e.target.id === "modal-safety-backdrop") hideModal("safety");
        });
    }

    function initGeo() {
      updateRegionLabel();
      if (!("geolocation" in navigator)) return;
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          userLocation = {
            name: userLocation.name || "–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ",
            lat: latitude,
            lon: longitude,
            source: "gps"
          };
          updateRegionLabel();
          cityInputEl.value = ""; // –æ—á–∏—â–∞–µ–º —Ä—É—á–Ω–æ–π –ø–æ–∏—Å–∫ –ø—Ä–∏ GPS
          if (lastFetchRawEvents.length) {
            groupAndRenderEvents(lastFetchRawEvents);
          }
        },
        (err) => {
          console.log("Geo error:", err);
        },
        { enableHighAccuracy: true, timeout: 8000 }
      );
    }

    function requestGeoOnClick() {
      if (!("geolocation" in navigator)) {
        alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          userLocation = {
            name: "–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ",
            lat: latitude,
            lon: longitude,
            source: "gps"
          };
          updateRegionLabel();
          cityInputEl.value = ""; // –æ—á–∏—â–∞–µ–º —Ä—É—á–Ω–æ–π –≥–æ—Ä–æ–¥
          if (lastFetchRawEvents.length) {
            groupAndRenderEvents(lastFetchRawEvents);
          } else {
            fetchEarthquakes();
          }
        },
        (err) => {
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é: " + err.message);
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    }

    function initInstallButton() {
      const btnInstall = document.getElementById("btn-install");
      let deferredPrompt = null;

      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        btnInstall.disabled = false;
      });

      btnInstall.addEventListener("click", async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt = null;
        } else {
          alert(
            "–ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Seismo-Wake, –æ—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω¬ª."
          );
        }
      });
    }

    function initUI() {
      initCityDatalist();
      initLangSwitch();
      initModals();
      initGeo();
      initInstallButton();

      document
        .getElementById("btn-refresh")
        .addEventListener("click", fetchEarthquakes);
      document
        .getElementById("btn-use-geo")
        .addEventListener("click", requestGeoOnClick);
      document
        .getElementById("btn-open-online")
        .addEventListener("click", () => {
          window.open(
            "https://zhanat-arch.github.io/Seismo-Wake/",
            "_blank",
            "noopener"
          );
        });

      cityInputEl.addEventListener("change", handleCityInputChange);
      cityInputEl.addEventListener("input", (e) => {
        // –∫–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—é—Ç –∏–∑ datalist, —Å–æ–±—ã—Ç–∏–µ input —Ç–æ–∂–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
        // –ø–æ–¥–æ–∂–¥—ë–º —á—É—Ç—å-—á—É—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏–º –≤—ã–±–æ—Ä
        setTimeout(handleCityInputChange, 100);
      });

      fetchEarthquakes();
      startAutoRefresh();
    }

    document.addEventListener("DOMContentLoaded", initUI);
  </script>
</body>
</html>
